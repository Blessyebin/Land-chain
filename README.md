

# 🏞️ Land-Chain: Tokenized Land Ownership with Chainlink & IPFS

> **Tagline**: Tokenizing Real-World Land into Verifiable Digital Assets

---

## 🔗 Overview

**Land-Chain** is a decentralized application (dApp) that allows users to tokenize real-world land assets into ERC-1155 NFTs. Each token includes dynamic metadata generated by a backend service, uploaded to IPFS, and fetched on-chain using **Chainlink Functions**.

The project uses:

* 🧭 OpenStreetMap + Puppeteer to snapshot land plots
* 🧬 Chainlink Functions for dynamic metadata generation and periodic updates
* 💽 Pinata (IPFS) to host metadata & land documents
* 🔐 Chainlink Automation (optional) to trigger metadata refresh

---

## 📦 Backend: `land-dnft-api.mjs`

### 🔧 Responsibilities

* Accepts land data: `name`, `description`, `price`, `coordinates`, and an optional document
* Generates a map snapshot from coordinates using **Leaflet.js + Puppeteer**
* Uploads the snapshot and metadata to IPFS (via Pinata)
* Returns the final metadata URI for minting the NFT

### 📥 API Endpoint

```http
POST /create-land-dnft
```

#### Form Data

| Field         | Type        | Required | Description                                   |
| ------------- | ----------- | -------- | --------------------------------------------- |
| `name`        | string      | ✅        | Name of the land NFT                          |
| `description` | string      | ✅        | Land description                              |
| `price`       | string      | ✅        | Price in USD                                  |
| `coordinates` | JSON string | ✅        | Array of lat/lon points                       |
| `document`    | File        | ❌        | Optional supporting land document (PDF, etc.) |

#### Example `curl`

```bash
curl -X POST http://localhost:4000/create-land-dnft \
  -F 'name=Land Token' \
  -F 'description=A plot in Lagos' \
  -F 'price=2000' \
  -F 'coordinates=[[6.427853,3.432125],[6.427853,3.431449],[6.428337,3.431449],[6.428337,3.432125]]' \
  -F 'document=@land-doc.pdf'
```

#### Response

```json
{
  "metadataUri": "ipfs://bafy...",
  "gateway": {
    "image": "https://gateway.pinata.cloud/ipfs/bafy...",
    "metadata": "https://gateway.pinata.cloud/ipfs/bafy..."
  }
}
```

---

### 📁 Metadata Standard (OpenSea Compatible)

```json
{
  "name": "Land Token",
  "description": "A plot near Lagos",
  "image": "ipfs://bafy...",
  "attributes": [
    { "trait_type": "Price (USD)", "value": "2000" },
    { "trait_type": "Coordinates", "value": "6.42,3.43 | ..." },
    { "trait_type": "Land Document", "value": "ipfs://bafy..." }
  ]
}
```

---

## 🧠 Smart Contract: `Issuer.sol`

### 🧱 Structure

The `Issuer.sol` contract interacts with:

* ✅ `ERC1155Core`: handles token minting and URI management
* ✅ `FunctionsSource`: stores inline JavaScript used by Chainlink Functions
* ✅ `FunctionsClient`: makes requests to Chainlink Functions
* ✅ `FunctionsRequest`: builds and encodes requests
* ✅ `OwnerIsCreator`: access control for the owner

### 🎯 Responsibilities

* Triggers metadata generation via Chainlink Functions
* Mints ERC-1155 tokens with dynamic `tokenURI`
* Supports post-mint metadata updates via Chainlink Functions
* (Optional) Integrates Chainlink Automation for scheduled updates

---

### 🧾 Function: `issue`

```solidity
function issue(
  address to,
  uint256 amount,
  string[] calldata args,
  uint64 subscriptionId,
  uint32 gasLimit,
  bytes32 donID
) external onlyOwner returns (bytes32 requestId);
```

* Triggers metadata generation via `getNftMetadata()` JS source
* Mints a new token using dynamic `tokenURI` returned from Chainlink

---

### ✏️ Function: `updateMetadata`

```solidity
function updateMetadata(
  uint256 tokenId,
  string[] calldata args,
  uint64 subscriptionId,
  uint32 gasLimit,
  bytes32 donID
) external onlyOwner returns (bytes32 requestId);
```

* Triggers a metadata update using `getNftMetadata1()` source
* Calls `updateTokenURI(tokenId, newURI)` on the ERC1155 core

---

### 🔄 Chainlink Fulfillment

```solidity
function fulfillRequest(bytes32 requestId, bytes memory response, bytes memory err)
```

* Called by Chainlink
* Mints or updates token depending on the request type

---

### 📤 Chainlink JavaScript Source (Inline)

Example source in `FunctionsSource.sol`:

```js
const image = args[0];
const apiResponse = await Functions.makeHttpRequest({ url: "https://..." });
const metadata = apiResponse.data;
metadata.image = image;
const metadataString = JSON.stringify(metadata);
const ipfsHash = await import('ipfs-only-hash').then((mod) => mod.of(metadataString));
return Functions.encodeString(`ipfs://${ipfsHash}`);
```

---

## 🔧 Technologies Used

* Solidity (`ERC1155`, Chainlink Functions)
* JavaScript (Node.js + Express)
* Puppeteer
* Leaflet.js
* Chainlink Functions & Automation
* Pinata (IPFS)
* OpenStreetMap tiles
* Axios + FormData (frontend testing)

---

## 🚧 Challenges Faced

* Handling large coordinate datasets without breaking metadata
* Puppeteer resource handling in memory-limited environments
* Ensuring OpenSea metadata compatibility
* Managing request states and tokenId assignments with Chainlink Functions
* Uploading multiple file types (image + document)

---

## ✅ Future Improvements

* Add support for Chainlink Automation to update metadata periodically
* Enable user-submitted metadata from the frontend
* Support map style selection
* Add document previewing on OpenSea using `animation_url`

---

Let me know if you want this split into separate `README.md` files for backend and smart contracts.
